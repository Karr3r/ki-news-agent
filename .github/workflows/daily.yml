name: T채gliches KI-Update

on:
  schedule:
    - cron: '30 5 * * *'   # 07:30 MESZ
  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-latest

    # Secrets als Umgebungsvariablen verf체gbar machen
    env:
      OPENAI_API_KEY:     ${{ secrets.OPENAI_API_KEY }}
      EMAIL_ADDRESS:      ${{ secrets.EMAIL_ADDRESS }}
      EMAIL_APP_PASSWORD: ${{ secrets.EMAIL_APP_PASSWORD }}
      EMAIL_RECEIVER:     ${{ secrets.EMAIL_RECEIVER }}

    steps:
      - name: Code auschecken
        uses: actions/checkout@v4

      # Vorheriges processed_articles.json herunterladen (falls vorhanden)
      - name: Download processed_articles.json
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          name: processed-articles
          path: .

      - name: Python-Umgebung einrichten
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Abh채ngigkeiten installieren
        run: |
          python -m pip install --upgrade pip
          pip install feedparser openai python-dotenv

      - name: Agent ausf체hren
        run: python agent_allgemein_ki.py

      # Aktuelles processed_articles.json hochladen
      - name: Upload processed_articles.json
        uses: actions/upload-artifact@v4
        with:
          name: processed-articles
          path: processed_articles.json

